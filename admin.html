<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Panel – Diesel Designs</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
  <style>
    html {
      scroll-behavior: smooth;
    }
    nav {
      position: sticky;
      top: 0;
      background: white;
      padding: 1rem;
      z-index: 100;
      border-bottom: 1px solid #ddd;
    }
    nav ul {
      display: flex;
      gap: 1rem;
      list-style: none;
      padding-left: 0;
    }
    nav ul li a {
      text-decoration: none;
    }
    textarea {
      width: 100%;
    }
    input[type="text"] {
      width: 80%;
    }
    .question-row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>

  <!-- ✅ NAVIGATION MENU -->
  <nav class="container">
    <ul>
      <li><strong>Admin Panel</strong></li>
    </ul>
    <ul>
      <li><a href="#questions">Questions</a></li>
      <li><a href="#agreement">Agreement</a></li>
      <li><a href="#submissions">Submissions</a></li>
    </ul>
  </nav>

  <main class="container">

    <!-- ✅ Manage Questions -->
    <section id="questions">
      <h2>Manage Questions</h2>
      <div id="question-list"></div>
      <button onclick="addQuestion()">➕ Add Question</button>
      <button onclick="saveQuestions()">💾 Save Questions</button>
    </section>

    <hr />

    <!-- ✅ Agreement Text -->
    <section id="agreement">
      <h2>Edit Agreement Text</h2>
      <textarea id="agreement-text" rows="10" placeholder="Loading agreement..."></textarea>
      <button onclick="saveAgreement()">💾 Save Agreement</button>
    </section>

    <hr />

    <!-- ✅ View Submissions -->
    <section id="submissions">
      <h2>Submissions</h2>
      <ul id="submission-list">
        <li>Loading submissions...</li>
      </ul>
    </section>

  </main>

  <script>
    let questions = [];

    // ✅ Load questions from server
    async function fetchQuestions() {
      try {
        const res = await fetch('/admin/questions');
        if (!res.ok) throw new Error('Failed to fetch questions');
        questions = await res.json();
        renderQuestions();
      } catch (err) {
        alert('❌ Error loading questions');
        console.error(err);
      }
    }

    // ✅ Render questions to DOM
    function renderQuestions() {
      const list = document.getElementById('question-list');
      list.innerHTML = '';
      questions.forEach((q, i) => {
        const div = document.createElement('div');
        div.className = 'question-row';
        div.innerHTML = `
          <input type="text" value="${q}" onchange="questions[${i}] = this.value" />
          <button onclick="removeQuestion(${i})">🗑️</button>
        `;
        list.appendChild(div);
      });
    }

    function addQuestion() {
      questions.push('');
      renderQuestions();
    }

    function removeQuestion(index) {
      questions.splice(index, 1);
      renderQuestions();
    }

    async function saveQuestions() {
      try {
        const res = await fetch('/admin/questions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(questions)
        });
        if (!res.ok) throw new Error('Failed to save questions');
        alert('✅ Questions saved!');
      } catch (err) {
        alert('❌ Error saving questions');
        console.error(err);
      }
    }

    async function fetchAgreement() {
      try {
        const res = await fetch('/admin/agreement');
        if (!res.ok) throw new Error('Failed to fetch agreement');
        const text = await res.text();
        document.getElementById('agreement-text').value = text;
      } catch (err) {
        alert('❌ Error loading agreement');
        console.error(err);
      }
    }

    async function saveAgreement() {
      const text = document.getElementById('agreement-text').value;
      try {
        const res = await fetch('/admin/agreement', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        if (!res.ok) throw new Error('Failed to save agreement');
        alert('✅ Agreement saved!');
      } catch (err) {
        alert('❌ Failed to save agreement.');
        console.error(err);
      }
    }

    async function fetchSubmissions() {
      try {
        const res = await fetch('/admin/submissions');
        if (!res.ok) throw new Error('Failed to fetch submissions');
        const files = await res.json();
        const list = document.getElementById('submission-list');
        list.innerHTML = '';
        files.forEach(file => {
          const li = document.createElement('li');
          li.textContent = file;
          list.appendChild(li);
        });
      } catch (err) {
        document.getElementById('submission-list').innerHTML = '<li>❌ Error loading submissions</li>';
        console.error(err);
      }
    }

    // ✅ On page load
    fetchQuestions();
    fetchAgreement();
    fetchSubmissions();
  </script>

</body>
</html>
