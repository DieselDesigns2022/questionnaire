<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Panel ‚Äì Diesel Designs</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
  <style>
    html {
      scroll-behavior: smooth;
    }

    nav {
      position: sticky;
      top: 0;
      background: white;
      padding: 1rem;
      z-index: 100;
      border-bottom: 1px solid #ddd;
    }

    nav ul {
      display: flex;
      gap: 1rem;
      list-style: none;
      padding-left: 0;
    }

    nav ul li a {
      text-decoration: none;
    }
  </style>
</head>
<body>
  <!-- ‚úÖ NAVIGATION MENU -->
  <nav class="container">
    <ul>
      <li><strong>Admin Panel</strong></li>
    </ul>
    <ul>
      <li><a href="#submissions">Submissions</a></li>
      <li><a href="#questions">Manage Questions</a></li>
      <li><a href="#agreement">Agreement Text</a></li>
    </ul>
  </nav>

  <main class="container">

    <!-- ‚úÖ SECTION: Submissions Placeholder -->
    <section id="submissions">
      <h2>Submissions (Coming Soon)</h2>
      <p>This section will allow you to view and download submission files.</p>
    </section>

    <hr />

    <!-- ‚úÖ SECTION: Manage Questions -->
    <section id="questions">
      <h2>Manage Questions</h2>
      <ul id="question-list"></ul>
      <button onclick="addQuestion()">+ Add Question</button>
      <button onclick="saveQuestions()">üíæ Save Questions</button>
    </section>

    <hr />

    <!-- ‚úÖ SECTION: Edit Agreement Text -->
    <section id="agreement">
      <h2>Edit Agreement Text</h2>
      <textarea id="agreement-text" rows="10" placeholder="Loading agreement..."></textarea>
      <button onclick="saveAgreement()">üíæ Save Agreement</button>
    </section>

  </main>

  <script>
    let questions = [];

    async function fetchQuestions() {
      try {
        const res = await fetch('/admin/questions');
        questions = await res.json();
        renderQuestions();
      } catch (err) {
        alert('Error loading questions');
      }
    }

    function renderQuestions() {
      const list = document.getElementById('question-list');
      list.innerHTML = '';
      questions.forEach((q, i) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <input type="text" value="${q}" onchange="questions[${i}] = this.value" />
          <button onclick="removeQuestion(${i})">üóëÔ∏è</button>
        `;
        list.appendChild(li);
      });
    }

    function addQuestion() {
      questions.push('');
      renderQuestions();
    }

    function removeQuestion(index) {
      questions.splice(index, 1);
      renderQuestions();
    }

    async function saveQuestions() {
      try {
        await fetch('/admin/questions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(questions)
        });
        alert('Questions saved!');
      } catch (err) {
        alert('Error saving questions');
      }
    }

    async function fetchAgreement() {
      const res = await fetch('/admin/agreement');
      const text = await res.text();
      document.getElementById('agreement-text').value = text;
    }

    async function saveAgreement() {
      const text = document.getElementById('agreement-text').value;
      try {
        await fetch('/admin/agreement', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        alert('Agreement saved!');
      } catch (err) {
        alert('Error saving agreement');
      }
    }

    // Init
    fetchQuestions();
    fetchAgreement();
  </script>
</body>
</html>
