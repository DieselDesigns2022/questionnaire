<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Panel ‚Äì Diesel Designs</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
  <style>
    html {
      scroll-behavior: smooth;
    }

    nav {
      position: sticky;
      top: 0;
      background: white;
      padding: 1rem;
      z-index: 100;
      border-bottom: 1px solid #ddd;
    }

    nav ul {
      display: flex;
      gap: 1rem;
      list-style: none;
      padding-left: 0;
    }

    nav ul li a {
      text-decoration: none;
    }

    select {
      min-width: 120px;
    }
  </style>
</head>
<body>
  <nav class="container">
    <ul>
      <li><strong>Admin Panel</strong></li>
    </ul>
    <ul>
      <li><a href="#questions">Questions</a></li>
      <li><a href="#agreement">Agreement</a></li>
    </ul>
  </nav>

  <main class="container">
    <section id="questions">
      <h2>Manage Questions</h2>
      <ul id="question-list"></ul>
      <button onclick="addQuestion()">+ Add Question</button>
      <button onclick="saveQuestions()">üíæ Save Questions</button>
    </section>

    <hr />

    <section id="agreement">
      <h2>Agreement Text</h2>
      <textarea id="agreement-text" rows="10" placeholder="Loading agreement..."></textarea>
      <button onclick="saveAgreement()">üíæ Save Agreement</button>
    </section>
  </main>

  <script>
    let questions = [];

    async function fetchQuestions() {
      try {
        const res = await fetch('/admin/questions');
        questions = await res.json();
        renderQuestions();
      } catch (err) {
        alert('‚ùå Error loading questions');
      }
    }

    function renderQuestions() {
      const list = document.getElementById('question-list');
      list.innerHTML = '';
      questions.forEach((q, i) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <input type="text" placeholder="Label" value="${q.label || ''}" onchange="questions[${i}].label = this.value" />
          <input type="text" placeholder="Name" value="${q.name || ''}" onchange="questions[${i}].name = this.value" />
          <select onchange="questions[${i}].type = this.value">
            <option value="text" ${q.type === 'text' ? 'selected' : ''}>Text</option>
            <option value="textarea" ${q.type === 'textarea' ? 'selected' : ''}>Textarea</option>
            <option value="checkbox" ${q.type === 'checkbox' ? 'selected' : ''}>Checkbox</option>
            <option value="file" ${q.type === 'file' ? 'selected' : ''}>Image Upload</option>
          </select>
          <label>
            Required?
            <input type="checkbox" ${q.required ? 'checked' : ''} onchange="questions[${i}].required = this.checked" />
          </label>
          <button onclick="removeQuestion(${i})">üóëÔ∏è</button>
        `;
        list.appendChild(li);
      });
    }

    function addQuestion() {
      questions.push({ label: '', type: 'text', name: '', required: false });
      renderQuestions();
    }

    function removeQuestion(index) {
      questions.splice(index, 1);
      renderQuestions();
    }

    async function saveQuestions() {
      try {
        await fetch('/admin/questions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(questions)
        });
        alert('‚úÖ Questions saved!');
      } catch (err) {
        alert('‚ùå Failed to save questions');
      }
    }

    async function fetchAgreement() {
      try {
        const res = await fetch('/admin/agreement');
        const text = await res.text();
        document.getElementById('agreement-text').value = text;
      } catch {
        alert('‚ùå Error loading agreement');
      }
    }

    async function saveAgreement() {
      const text = document.getElementById('agreement-text').value;
      try {
        await fetch('/admin/agreement', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        alert('‚úÖ Agreement saved!');
      } catch {
        alert('‚ùå Failed to save agreement');
      }
    }

    // Init
    fetchQuestions();
    fetchAgreement();
  </script>
</body>
</html>
