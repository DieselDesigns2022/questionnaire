<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel</title>
  <style>
    body {
      background: #0d1b2a;
      color: #fff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 40px;
    }
    h1 {
      font-size: 2rem;
    }
    a {
      color: #4fc3f7;
      text-decoration: none;
      display: block;
      margin-bottom: 6px;
      transition: 0.2s;
    }
    a:hover {
      color: #81d4fa;
    }
    pre {
      background: #f1f1f1;
      color: #111;
      padding: 20px;
      white-space: pre-wrap;
      word-wrap: break-word;
      border-radius: 4px;
      margin-top: 20px;
    }
    .file-list {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>üõ†Ô∏è Admin Panel</h1>
  <p>Click a submission file to view its contents:</p>
  <div class="file-list" id="fileList">Loading...</div>
  <pre id="jsonOutput"><i>Select a submission file to view its JSON data here.</i></pre>

  <script>
    async function fetchSubmissions() {
      const fileListEl = document.getElementById('fileList');
      const outputEl = document.getElementById('jsonOutput');

      try {
        const res = await fetch('/submissions');
        const files = await res.json();

        fileListEl.innerHTML = ''; // Clear loading text

        for (const file of files) {
          const link = document.createElement('a');
          link.href = "#";
          link.textContent = file;

          link.addEventListener('click', async (e) => {
            e.preventDefault();
            const res = await fetch('/submissions/' + file);
            const data = await res.json();

            // Show JSON
            outputEl.textContent = JSON.stringify(data, null, 2);

            // Remove previous image if any
            const oldImg = document.getElementById('uploadedImage');
            if (oldImg) oldImg.remove();

            // If it has an image, show it
            if (data.image) {
              const img = document.createElement('img');
              img.id = 'uploadedImage';
              img.src = data.image;
              img.style.maxWidth = '300px';
              img.style.display = 'block';
              img.style.marginTop = '20px';
              outputEl.after(img);
            }
          });

          // Fetch each file to check if it contains an image
          try {
            const res = await fetch('/submissions/' + file);
            const json = await res.json();
            if (json.image) {
              link.textContent = 'üì∑ ' + file;
            }
          } catch (err) {
            console.warn('Error loading', file, err);
          }

          fileListEl.appendChild(link);
        }
      } catch (err) {
        fileListEl.textContent = 'Error loading submission list.';
        console.error(err);
      }
    }

    fetchSubmissions();
  </script>
</body>
</html>
