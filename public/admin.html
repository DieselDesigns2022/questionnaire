<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Panel ‚Äì Diesel Designs</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
</head>
<body>
  <main class="container">
    <h1>Admin Panel</h1>

    <!-- üîß Manage Questions -->
    <section>
      <h2>Questions</h2>
      <ul id="question-list"></ul>
      <button onclick="addQuestion()">+ Add Question</button>
      <button onclick="saveQuestions()">üíæ Save Questions</button>
    </section>

    <hr />

    <!-- üìÑ Edit Agreement Text -->
    <section>
      <h2>Edit Agreement Text</h2>
      <textarea id="agreement-text" rows="10" placeholder="Loading agreement..."></textarea>
      <button onclick="saveAgreement()">üíæ Save Agreement</button>
    </section>
  </main>

  <script>
    let questions = [];

    async function fetchQuestions() {
      try {
        const res = await fetch('/admin/questions');
        questions = await res.json();
        renderQuestions();
      } catch (err) {
        alert('Error loading questions');
      }
    }

    function renderQuestions() {
      const list = document.getElementById('question-list');
      list.innerHTML = '';
      questions.forEach((q, i) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <input type="text" value="${q}" onchange="questions[${i}] = this.value" />
          <button onclick="removeQuestion(${i})">üóëÔ∏è</button>
        `;
        list.appendChild(li);
      });
    }

    function addQuestion() {
      questions.push('');
      renderQuestions();
    }

    function removeQuestion(index) {
      questions.splice(index, 1);
      renderQuestions();
    }

    async function saveQuestions() {
      try {
        await fetch('/admin/questions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(questions)
        });
        alert('Questions saved!');
      } catch (err) {
        alert('Error saving questions');
      }
    }

    async function fetchAgreement() {
      const res = await fetch('/admin/agreement');
      const text = await res.text();
      document.getElementById('agreement-text').value = text;
    }

    async function saveAgreement() {
      const text = document.getElementById('agreement-text').value;
      try {
        await fetch('/admin/agreement', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        alert('Agreement saved!');
      } catch (err) {
        alert('Error saving agreement');
      }
    }

    // Init
    fetchQuestions();
    fetchAgreement();
  </script>
</body>
</html>
